name: Daily Plant-Based Recipe Generator

on:
  schedule:
    - cron: '0 9 * * *'
  workflow_dispatch:

jobs:
  create-recipe-issue:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    
    steps:
      - name: Generate Multi-Step Recipe Issue
        uses: actions/github-script@v7
        with:
          script: |
            const today = new Date().toISOString().split('T')[0];
            
            const issueBody = `## ðŸŒ± Daily Plant-Based Recipe

            **Date:** ${today}

            @copilot using @recipe-workflow please create today's recipe

            ---

            This issue uses the unified recipe workflow agent to create a complete, publication-ready plant-based recipe blog post in a single workflow.

            ## What the Agent Will Create

            The @recipe-workflow agent will handle:
            - âœ… Recipe creation (100% plant-based, UK measurements, British English)
            - âœ… Image planning with detailed AI generation prompts
            - âœ… Blog-style introduction and storytelling
            - âœ… SEO optimization (titles, meta descriptions, tags)
            - âœ… Editorial review and quality assurance
            - âœ… Jekyll publication formatting

            ## Output

            A complete markdown file ready for the _posts/ directory:
            - Filename: ${today}-[recipe-name-in-kebab-case].markdown
            - Complete YAML frontmatter
            - Publication-ready content

            ## Recipe Variety

            Please choose from: breakfast, lunch, dinner, snacks, desserts, beverages, baking, salads, soups, mains, sides

            ---

            **Instructions:** The agent will create a complete recipe post. Once generated, review and commit to the _posts/ directory.`;
            
            const issue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ðŸŒ± Daily Recipe: Plant-Based Recipe for ${today}`,
              body: issueBody,
              labels: ['recipe', 'automation', 'plant-based']
            });
            
            console.log(`Created recipe issue #${issue.data.number}: ${issue.data.html_url}`);
            
            await github.rest.issues.addAssignees({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.data.number,
              assignees: ['copilot']
            });
            
            console.log(`Assigned @copilot with @recipe-workflow agent to issue #${issue.data.number}`);